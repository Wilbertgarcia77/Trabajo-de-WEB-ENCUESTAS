@{
    ViewData["Title"] = "Resultados y Recomendaciones";
}

<div style="max-width:700px;margin:40px auto;padding:40px;background:#fff;border-radius:16px;box-shadow:0 4px 24px rgba(0,0,0,0.10);">
    <h2 style="color:#007bff;font-weight:bold;text-align:center;">Selecciona una encuesta</h2>
    <form asp-action="ObtenerRecomendacion" method="post" style="margin-bottom:20px;">
        <select name="tipoEncuesta" class="form-control" style="margin-bottom:20px;">
            <option value="">Seleccione una encuesta</option>
            @{
                var encuestasSelect = ViewBag.Encuestas as List<dynamic>;
                if (encuestasSelect != null)
                {
                    foreach (var encuesta in encuestasSelect)
                    {
                        <option value="@encuesta.tipo">@encuesta.tipo</option>
                    }
                }
            }
        </select>
        <button type="submit" class="btn btn-success" style="width:100%;">Obtener recomendación</button>
    </form>

    <h3 style="color:#333;font-weight:bold;text-align:center;margin-top:30px;">Historial de encuestas guardadas</h3>
    <div style="background:#fff;padding:30px 20px;border-radius:16px;box-shadow:0 4px 24px rgba(0,0,0,0.10);margin-bottom:20px;">
        @{
            var encuestasHist = ViewBag.Encuestas as List<dynamic>;
            var rol = ViewBag.Rol as string ?? "cliente";
            if (encuestasHist != null && encuestasHist.Count > 0)
            {
                <div style="display:flex;flex-direction:column;gap:24px;">
                @for (int i = 0; i < encuestasHist.Count; i++)
                {
                    var encuesta = encuestasHist[i];
                    <div style="background:#f8f9fa;border-radius:12px;padding:18px 24px;box-shadow:0 2px 8px rgba(0,0,0,0.07);position:relative;">
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <span style="font-size:1.1rem;font-weight:bold;color:#007bff;">@encuesta.tipo</span>
                            <form asp-action="EliminarEncuesta" method="post" style="margin:0;">
                                <input type="hidden" name="tipoEncuesta" value="@encuesta.tipo" />
                                <button type="submit" class="btn btn-danger btn-sm" style="border-radius:6px;font-weight:bold;">Eliminar</button>
                            </form>
                        </div>
                        <div style="margin-top:10px;">
                            <pre style="background:#fff;padding:12px;border-radius:8px;white-space:pre-wrap;font-size:1rem;">@encuesta.datos</pre>
                        </div>
                        @if (rol == "administrador" && encuesta.usuario != null)
                        {
                            <div style="margin-top:10px;background:#e9ecef;padding:10px;border-radius:8px;">
                                <strong>Usuario:</strong> @encuesta.usuario
                            </div>
                        }
                    </div>
                }
                </div>
            }
            else
            {
                <div style="color:#888;text-align:center;">No tienes encuestas guardadas aún.</div>
            }
        }
    </div>

    <h2 style="color:#007bff;font-weight:bold;text-align:center;">Tus Respuestas</h2>
    <pre style="background:#f8f9fa;padding:20px;border-radius:10px;">@ViewBag.Respuestas</pre>

    <hr />

    <h2 style="color:#28a745;font-weight:bold;text-align:center;">Recomendación Personalizada</h2>
    <div style="background:#f8f9fa;padding:20px;border-radius:10px;font-size:1.2rem;">@ViewBag.Recomendacion</div>
</div>
